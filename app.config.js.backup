import 'dotenv/config';

const IS_PRODUCTION = process.env.APP_ENV === 'production';
const IS_STAGING = process.env.APP_ENV === 'staging';
const IS_DEVELOPMENT = process.env.APP_ENV === 'development';

export default {
  expo: {
    name: IS_PRODUCTION ? 'CulturaFlow' : IS_STAGING ? 'CulturaFlow (Staging)' : 'CulturaFlow (Dev)',
    slug: 'cultura-flow',
    version: process.env.APP_VERSION || '1.0.0',
    orientation: 'portrait',
    userInterfaceStyle: 'automatic',
    splash: {
      backgroundColor: '#6366f1',
    },
    assetBundlePatterns: ['**/*'],
    ios: {
      supportsTablet: true,
      bundleIdentifier: IS_PRODUCTION 
        ? 'com.culturaflow.app' 
        : IS_STAGING 
        ? 'com.culturaflow.app.staging' 
        : 'com.culturaflow.app.dev',
      buildNumber: '1',
      infoPlist: {
        NSCameraUsageDescription: 'This app may use the camera to capture images for cultural content sharing.',
        NSMicrophoneUsageDescription: 'This app may use the microphone for audio interactions and feedback.',
        NSLocationWhenInUseUsageDescription: 'This app uses location to provide culturally relevant content based on your region.',
      },
      privacyManifests: {
        NSPrivacyAccessedAPITypes: [
          {
            NSPrivacyAccessedAPIType: 'NSPrivacyAccessedAPICategoryUserDefaults',
            NSPrivacyAccessedAPITypeReasons: ['CA92.1'],
          },
        ],
      },
    },
    android: {
      package: IS_PRODUCTION 
        ? 'com.culturaflow.app' 
        : IS_STAGING 
        ? 'com.culturaflow.app.staging' 
        : 'com.culturaflow.app.dev',
      versionCode: 1,
      permissions: [
        'CAMERA',
        'RECORD_AUDIO',
        'ACCESS_FINE_LOCATION',
        'ACCESS_COARSE_LOCATION',
        'INTERNET',
        'ACCESS_NETWORK_STATE',
      ],
    },
    web: {
      bundler: 'metro',
    },
    plugins: [
      'react-native-reanimated/plugin',
      [
        'expo-build-properties',
        {
          ios: {
            newArchEnabled: false,
          },
          android: {
            newArchEnabled: false,
          },
        },
      ],
    ],
    runtimeVersion: {
      policy: 'sdkVersion',
    },
    extra: {
      API_BASE_URL: process.env.API_BASE_URL,
      WEBSOCKET_URL: process.env.WEBSOCKET_URL,
      APP_ENV: process.env.APP_ENV,
      DEBUG_MODE: process.env.DEBUG_MODE === 'true',
      LOG_LEVEL: process.env.LOG_LEVEL,
      ENABLE_OFFLINE_MODE: process.env.ENABLE_OFFLINE_MODE === 'true',
      ENABLE_GAMIFICATION: process.env.ENABLE_GAMIFICATION === 'true',
      ENABLE_SOCIAL_FEATURES: process.env.ENABLE_SOCIAL_FEATURES === 'true',
      SENTRY_DSN: process.env.SENTRY_DSN,
      SENTRY_DSN_STAGING: process.env.SENTRY_DSN_STAGING,
      ANALYTICS_KEY: process.env.ANALYTICS_KEY,
      ANALYTICS_KEY_STAGING: process.env.ANALYTICS_KEY_STAGING,
    },
  },
};